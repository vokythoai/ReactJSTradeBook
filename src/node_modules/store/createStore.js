import { applyMiddleware, compose, createStore } from 'redux'
import { enableBatching } from 'redux-batched-actions'
import rootReducer from './reducers'
import appSagas from 'sagas/rootSaga'
import createLogger from 'redux-logger'
import createSagaMiddleware from 'redux-saga'

export default (initialState = {}) => {
  // ======================================================
  // Middleware Configuration
  // ======================================================
  //
  //
  const logger = createLogger()
  const appSagasMiddleware = createSagaMiddleware()
  const middleware = [appSagasMiddleware]

  const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose
  const store = createStore(enableBatching(rootReducer), initialState, composeEnhancers(
    applyMiddleware(...middleware)
  ))
  appSagasMiddleware.run(appSagas)
  return store
}
